sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/ui/core/UIComponent","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/Fragment","sap/ndc/BarcodeScanner","com/rava/pedido/pedidoventa/controller/Service","sap/ui/core/BusyIndicator","sap/ui/model/json/JSONModel","com/rava/pedido/pedidoventa/model/models","sap/ui/model/Filter","com/rava/pedido/pedidoventa/model/formatter"],function(e,t,o,a,r,n,i,s,c,l,u,g,d){"use strict";var f;var v="";return e.extend("com.rava.pedido.pedidoventa.controller.BaseController",{formatter:d,validateUser:function(){f=this;var e=new sap.ui.model.json.JSONModel;this.getView().setModel(e);e.loadData("/services/userapi/attributes");return new Promise(function(t,o){e.attachRequestCompleted(function a(r){console.log("--------------------------:---------------------------");console.log(r);console.log(e);if(r.getParameter("success")){t(e.getData())}else{var n=r.getParameter("errorObject").textStatus;if(n){o(n);this.setData("status",n)}else{o("Unknown error retrieving user info");this.setData("status","Unknown error retrieving user info")}}})})},showErrorMessage:function(e,t){var o=String(t);return a.error(e,{title:"Error",details:o,styleClass:"sapUiSizeCompact",contentWidth:"100px"})},downloadFileCordova2:function(e,t){saveFile(dirEntry,blob,t)},downloadFileCordova:function(e,t){o(e);function o(){console.log("request file system");window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,i)}function a(e){console.log("file system retrieved");e.root.getFile(t,{create:true},r,i)}function r(e){console.log("file entry retrieved");e.createWriter(n,i)}function n(o){console.log("write to file");o.onwrite=function(e){alert("done")};o.write(e);window.open(t,"_blank")}function i(e){console.log(e.code);alert(e.code)}},getBlobFromFile:function(e){var t=e.substring(5,e.indexOf(";base64,"));var o="data:"+t+";base64,";var a=o.length;t=t||"";var r=512;var n=window.atob(e.substring(a));var i=[];for(var s=0;s<n.length;s+=r){var c=n.slice(s,s+r);var l=new Array(c.length);for(var u=0;u<c.length;u++){l[u]=c.charCodeAt(u)}var g=new Uint8Array(l);i.push(g)}var d=new Blob(i,{type:t});return d},getRouter:function(){return o.getRouterFor(this)},onNavBack:function(){var e=t.getInstance();var o=e.getPreviousHash();if(o!==undefined){window.history.go(-1)}else{var a=sap.ui.core.UIComponent.getRouterFor(this);a.navTo("RouteBusqueda")}},getI18nText:function(e){return this.oView.getModel("i18n")===undefined?false:this.oView.getModel("i18n").getResourceBundle().getText(e)},getResourceBundle:function(){return this.oView.getModel("i18n").getResourceBundle()},getModel:function(e){return this.oView.getModel(e)},_byId:function(e){var t=this.byId(e);if(!t){t=sap.ui.getCore().byId(e)}return t},getMessageBox:function(e,t){return a[e](t)},getMessageBox1:function(e,t,o){return a[e](t,o)},getMessageBoxFlex:function(e,t,o,r,n,i,l){f=o;return a[e](t,{actions:n===""?[l]:[n,l],onClose:function(e){if(e===n&&i==="ErrorUpdate"){f.createMessageLog(r,f)}if(e===n&&i==="InformationTreat"){var t={NoticeNumber:f._notification,Flag:"",SystemStatus:"",UserStatus:""};f.updateStateNotific("Treat",t,f)}if(e===n&&i==="InformationPostpone"){var t={NoticeNumber:f._notification,Flag:"",SystemStatus:"",UserStatus:""};f.updateStateNotific("Postpone",t,f)}if(e===n&&i==="InformationClose"){var t={NoticeNumber:f._notification,RefDate:r.RefDate,RefTime:r.RefTime,Flag:"",SystemStatus:"",UserStatus:""}}if(e===n&&i==="ErrorTakePhoto"){f._onTakePhoto()}if(e===l&&i==="SuccessUpdate"){var o=f._notification;f.getNotificationDetail(o)}if(e===n&&i==="WarningCancel"){var a=f.getModel("backup").getData();f.getModel("createAd").setData(JSON.parse(JSON.stringify(a)))}if(e===l&&i==="SuccesRegister"){var u=sap.ushell.Container.getService("CrossApplicationNavigation");u.toExternal({target:{semanticObject:"#"}})}if(e===n&&i==="ErrorUpload"){c.show();s.oFTP("create","/HeaderFileSet",f.aCreateFile,"","1",f).then(function(e){c.hide()},function(e){c.hide();f.getMessageBoxFlex("error",f.getI18nText("errorFTP"),f,"",f.getI18nText("yes"),"ErrorUpload",f.getI18nText("no"))})}if(e===n&&i==="ErrorUploadSharepoint"){f._saveDocuments(f.aCreateFile)}}})},createMessageLog:function(e,t){f=t;e.forEach(function(e){switch(e.MessageType){case"E":e.MessageType="Error";break;case"W":e.MessageType="Warning";break;case"I":e.MessageType="Information";break;default:}});var o=new sap.m.MessageItem({type:"{MessageType}",title:"{MessageText}"});var a=new l;a.setData(e);var r=new sap.m.Button({icon:sap.ui.core.IconPool.getIconURI("nav-back"),visible:false,press:function(){f.oMessageView.navigateBack();this.setVisible(false)}});this.oMessageView=new sap.m.MessageView({showDetailsPageHeader:false,itemSelect:function(){r.setVisible(true)},items:{path:"/",template:o}});this.oMessageView.setModel(a);this.oDialog=new sap.m.Dialog({resizable:true,content:this.oMessageView,state:"Error",beginButton:new sap.m.Button({press:function(){this.getParent().close()},text:"Cerrar"}),customHeader:new sap.m.Bar({contentMiddle:[new sap.m.Text({text:"Error"})],contentLeft:[r]}),contentHeight:"300px",contentWidth:"500px",verticalScrolling:false});this.oMessageView.navigateBack();this.oDialog.open()},getScanner:function(e,t,o){f=t;var a;if(!f._oScanDialog){f._oScanDialog=new sap.m.Dialog({title:"Scan barcode",contentWidth:"640px",contentHeight:"480px",horizontalScrolling:false,verticalScrolling:false,stretchOnPhone:true,content:[new sap.ui.core.HTML({content:"<div id='barcode'> <video id='barcodevideo'   autoplay></video>\t<canvas id='barcodecanvasg' ></canvas></div><canvas id='barcodecanvas' ></canvas><div id='result'></div>"})],endButton:new sap.m.Button({text:"Cancelar",press:function(e){f._oScanDialog.close()}.bind(f)}),afterOpen:function(){o.config.start=0;o.config.end=1;o.config.video="#barcodevideo";o.config.canvas="#barcodecanvas";o.config.canvasg="#barcodecanvasg";o.setHandler(function(e){f.getView().byId("equipment").setValue(e);f._oScanDialog.close();return new Promise(function(e,t){a=this.oModel.createKey("/Equipment",{Equipment:oData.EquipOrTechLocat});this.oModel.read(a,{success:function(t){e(t)},error:function(e){t();f.getMessageBox("error",f.getI18nText("error"));$.oLog.push({error:e,date:new Date})}})})});o.init()}.bind(f)});f.getView().addDependent(f._oScanDialog)}f._oScanDialog.open()},getDaysBefore:function(e,t){var o=864e5;var a=new Date(e.getTime()+t*o);a.setHours(0);a.setMinutes(0);a.setSeconds(0);return a},handleMessageToast:function(e){r.show(e)},setTextField:function(e,t){this._byId(e).setText(t)},setFragment:function(e,t,o,a){try{if(!a[e]){a[e]=sap.ui.xmlfragment(t,"com.rava.pedido.pedidoventa.view.dialogs."+o,a);a.getView().addDependent(a[e])}a[e].open()}catch(e){a.getMessageBox("error",a.getI18nText("error"));$.oLog.push({error:e,date:new Date})}},_treefy:function(e,t,o,a){var r=function(e){for(var t=0,o=e.length;t<o;t++){delete e[t]["__metadata"];if(e[t].nodes.length===0){delete e[t].nodes}else{r(e[t]["nodes"])}}};var n=[],i={},s,c;for(var l=0,u=e.length;l<u;l++){s=e[l];i[s[t]]=s;i[s[t]]["nodes"]=[]}for(var g in i){if(i.hasOwnProperty(g)){c=i[g];if(!c.Flag){c.ref="sap-icon://functional-location"}else{c.ref="sap-icon://machine"}if(c[t]&&c[o]!==""){i[c[o]]["nodes"].push(c)}else{n.push(c)}}}r(n);return n},_onCloseDialog:function(e){e.destroy()},reverseStringForParameter:function(e,t){var o=e.split(t);var a=o.reverse();var r=a.join(t);return r},onValidateChange:function(e){var t=e.getSource().getSelectedKey();var o=e.getSource().getValue();if(t!==""){e.getSource().setValue(o)}else{if(e.getSource().getValue()){this.getMessageBox("error",this.getI18nText("sErrorSelect"))}e.getSource().setValue("")}},liveChangeFormatInteger:function(e){var t=e.getSource();var o=t.getValue();var a=/[^\d]/g;var r=o.replace(/[^\d]/g,"");if(o.match(a)){var r=o}else{var r=o.substring(0,o.length-1)}var r=parseInt(o);var n=isNaN(r)?"":r;t.setValue(n)},liveChangeFormatFloat:function(e){var t=e.getSource();var o=t.getValue();var a=/[^\d]/g;var r=o.replace(/[^\d]/g,"");if(o.match(a)){var r=o}else{var r=""}var r=parseFloat(o);var n=isNaN(r)?"":r;t.setValue(n)},_onPressClose:function(e){var t=e.getSource();var o=t.data("custom");t.getParent().close()}})});